-module(queuesk_manager).
-behaviour(gen_server).

-export([start_link/0]).

-export([init/1,
	 handle_call/3,
	 handle_cast/2,
	 handle_info/2,
	 terminate/2,
	 code_change/3]).

-include("queuesk.hrl").

%%===================================================================
%% API Functions 
%%===================================================================

%%--------------------------------------------------------------------
%% start_link
%%--------------------------------------------------------------------
start_link() ->
    gen_server:start_link({local, ?MODULE}, ?MODULE, [], []).

%%====================================================================
%% Generic Server Callback
%%====================================================================

%%--------------------------------------------------------------------
%% init
%--------------------------------------------------------------------
init([]) ->
    
    ok = init_schedulers_pool(),

    %% @TODO: check if there are remaining tasks from last halt

    {ok, undefined}.

%%--------------------------------------------------------------------
%% handle_call
%%--------------------------------------------------------------------
handle_call(_Msg, _From, State) ->
    {reply, ok, State}.

%%--------------------------------------------------------------------
%% handle_cast
%%--------------------------------------------------------------------
handle_cast(_Msg, State) ->
    {noreply, State}.

%%--------------------------------------------------------------------
%% handle_info
%%--------------------------------------------------------------------
handle_info(_Msg, State) ->
    {noreply, State}.

%%--------------------------------------------------------------------
%% terminate
%%--------------------------------------------------------------------
terminate(_Reason, _State) ->
    ok.
%%--------------------------------------------------------------------
%% code_change
%%--------------------------------------------------------------------
code_change(_OldVsn, State, _Extra) ->
    {ok, State}.

%%====================================================================
%% Internal Functions
%%====================================================================

%%--------------------------------------------------------------------
%% init_schedulers_pool
%%--------------------------------------------------------------------
init_schedulers_pool() ->

    Queues = queuesk:queue_list(),
    [begin
	 queuesk_pool_sup:add_scheduler(Queue)
     end || Queue <- Queues],
    
    ok.
